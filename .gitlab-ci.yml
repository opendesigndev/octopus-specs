image: docker:latest

services:
  - docker:dind

stages:
  - build
  - release

before_script:
  - apk add --no-cache yarn
  - yarn


build-all:
  stage: build
  script:
    yarn build

  artifacts:
    paths:
      - packages/octopus-oas/dist/openapi.json
      - packages/octopus-ts/dist


release:
  stage: release
  script:
    - echo "//registry.npmjs.org/:_authToken=${NPM_TOKEN}" > ~/.npmrc
    - yarn release
  only:
    - tags
